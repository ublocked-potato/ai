<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¥” Etan ai </title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #0f0f23; color: white; height: 100vh; display: flex; align-items: center; justify-content: center;
        }
        .chat-container { width: 90%; max-width: 600px; height: 80vh; background: #1a1a2e; border-radius: 16px; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .chat-header { 
            padding: 20px; text-align: center; background: linear-gradient(135deg, #806CA1 0%, #667eea 100%); 
            border-radius: 16px 16px 0 0; font-size: 1.2em; font-weight: bold; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .message { padding: 12px 16px; border-radius: 18px; max-width: 80%; word-wrap: break-word; }
        .user { align-self: flex-end; background: #806CA1; }
        .ai { align-self: flex-start; background: #2d3748; }
        .chat-input-container { padding: 20px; display: flex; gap: 10px; border-top: 1px solid #333; }
        input[type="text"] { flex: 1; padding: 12px 16px; border: 1px solid #444; border-radius: 24px; background: #2d3748; color: white; font-size: 1em; }
        input[type="text"]:focus { outline: none; border-color: #806CA1; }
        button { padding: 12px 24px; background: #806CA1; color: white; border: none; border-radius: 24px; cursor: pointer; font-weight: bold; font-size: 0.9em; }
        button:hover { background: #6b5790; }
        button:disabled { background: #444; cursor: not-allowed; }
        .status { padding: 10px; text-align: center; font-size: 0.9em; opacity: 0.7; }
        .clear-btn { background: #ef4444; padding: 8px 16px; font-size: 0.8em; }
        .memory-indicator { background: #10b981; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <span>ðŸ¥” Etan AI</span>
            <div>
                <span class="memory-indicator" id="memoryStatus">Memory: ON</span>
                <button class="clear-btn" id="clearMemory" title="Clear chat history">Clear</button>
            </div>
        </div>
        <div class="status" id="status">Loading your chat history...</div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input-container">
            <input type="text" id="userInput" placeholder="AI remembers everything now! Ask about proxies..." autocomplete="off">
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const status = document.getElementById('status');
        const memoryStatus = document.getElementById('memoryStatus');
        const clearMemory = document.getElementById('clearMemory');

        // Load memory on page load
        let conversationHistory = localStorage.getItem('potatozoneAI_history') || 
            "You are potatozone AI - helpful for web development, PHP proxies, HTML/CSS/JS, GitHub Pages, free hosting.";
        
        let messages = []; // Individual messages for display

        // Load past messages
        function loadMemory() {
            const savedMessages = localStorage.getItem('potatozoneAI_messages');
            if (savedMessages) {
                messages = JSON.parse(savedMessages);
                messages.forEach(msg => addMessage(msg.text, msg.sender, false));
                status.textContent = `Loaded ${messages.length} past messages`;
            } else {
                addMessage("Hey! I'm your free web dev AI with full memory. I remember all our past chats! ðŸš€", 'ai', false);
                status.textContent = 'New chat - memory enabled';
            }
            setTimeout(() => status.textContent = 'Ready', 2000);
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
        clearMemory.addEventListener('click', () => {
            localStorage.clear();
            messages = [];
            chatMessages.innerHTML = '';
            addMessage("Memory cleared. Start fresh!", 'ai');
        });

        async function sendMessage() {
            const input = userInput.value.trim();
            if (!input) return;

            // Save & display user message
            const userMsg = { text: input, sender: 'user', timestamp: Date.now() };
            messages.push(userMsg);
            addMessage(input, 'user');
            userInput.value = '';
            sendBtn.disabled = true;
            status.textContent = 'AI thinking...';

            // Add to conversation history (keep under 2000 chars)
            conversationHistory += `\nHuman: ${input}`;
            if (conversationHistory.length > 1800) {
                conversationHistory = conversationHistory.slice(-1800);
            }

            try {
                const response = await fetch('https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        inputs: conversationHistory + "\nAI:",
                        parameters: { max_new_tokens: 150, temperature: 0.7, return_full_text: false }
                    })
                });

                const data = await response.json();
                
                let reply;
                if (data.error) {
                    reply = "Free AI busy (rate limit). I still remember everything though!";
                } else {
                    reply = data[0]?.generated_text?.trim() || 'Let me think...';
                    // Reference past context
                    if (messages.length > 1) {
                        reply += ` (chat ${messages.length})`;
                    }
                }

                const aiMsg = { text: reply, sender: 'ai', timestamp: Date.now() };
                messages.push(aiMsg);
                addMessage(reply, 'ai');
                
                // Auto-save everything
                localStorage.setItem('potatozoneAI_history', conversationHistory);
                localStorage.setItem('potatozoneAI_messages', JSON.stringify(messages.slice(-50))); // Last 50 messages
                
            } catch (error) {
                addMessage("Connection issue. But your messages are still saved!", 'ai');
            } finally {
                sendBtn.disabled = false;
                status.textContent = `Memory saved (${messages.length} total)`;
                setTimeout(() => status.textContent = 'Ready', 2000);
            }
        }

        function addMessage(text, sender, save = true) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = text;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Load on start
        loadMemory();
    </script>
</body>
</html>
